<!doctype html>
<html lang="id" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PayVeri â€¢ Verifikasi Token</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass{backdrop-filter:blur(10px);background:linear-gradient(180deg,rgba(255,255,255,.75),rgba(255,255,255,.55))}
    .dark .glass{background:linear-gradient(180deg,rgba(15,23,42,.6),rgba(15,23,42,.45))}
    .btn{transition:transform .05s ease}.btn:active{transform:scale(.98)}
  </style>
</head>
<body class="bg-gradient-to-b from-indigo-50 via-white to-slate-50 dark:from-slate-900 dark:via-slate-950 dark:to-slate-950 text-slate-800 dark:text-slate-100 min-h-screen">

  <!-- Header -->
  <header class="relative overflow-hidden">
    <div class="absolute inset-0 pointer-events-none">
      <div class="w-[48rem] h-[48rem] rounded-full bg-indigo-300/40 blur-3xl absolute -top-40 -left-40"></div>
      <div class="w-[42rem] h-[42rem] rounded-full bg-violet-300/40 blur-3xl absolute -bottom-56 -right-40"></div>
    </div>
    <div class="max-w-6xl mx-auto px-6 py-10 relative">
      <div class="flex items-center justify-between">
        <h1 class="text-3xl md:text-4xl tracking-tight font-normal">
          <span class="bg-gradient-to-r from-indigo-600 to-violet-600 bg-clip-text text-transparent font-extrabold">Selamat Datang di PayVeri
          <span class="block text-slate-700 dark:text-slate-300 text-lg">Verifikasi Login & Pembayaran</span>
        </h1>
        <button id="themeToggle" class="rounded-xl px-4 py-2 text-sm font-medium glass shadow hover:shadow-md transition">
          ðŸŒ™ Dark
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-6 pb-24 relative">
    <!-- Kartu Kunci -->
    <section class="glass rounded-3xl p-6 shadow-lg border border-white/40 dark:border-white/10 mb-6">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-9 h-9 rounded-xl bg-indigo-600 text-white grid place-items-center shadow">ðŸ”‘</div>
        <h2 class="font-semibold text-lg">Kunci Affine</h2>
        <span id="keyBadge" class="ml-auto text-xs px-2 py-1 rounded-full bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300">Belum dicek</span>
      </div>
      <div class="grid md:grid-cols-4 gap-3">
        <div>
          <label class="block text-sm mb-1">Kunci a</label>
          <input id="keyA" type="number" class="w-full border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/60 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 ring-indigo-500" value="5" placeholder="mis. 5">
        </div>
        <div>
          <label class="block text-sm mb-1">Kunci b</label>
          <input id="keyB" type="number" class="w-full border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/60 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 ring-indigo-500" value="8" placeholder="mis. 8">
        </div>
        <div class="md:col-span-2 flex items-end gap-2">
          <button id="btnCheckKey" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl px-4 py-2 shadow transition">Cek Kunci</button>
          <button id="btnRandomKey" class="px-4 py-2 rounded-xl bg-slate-900 text-white shadow hover:shadow-md transition">Acak</button>
        </div>
      </div>
      <p id="keyStatus" class="mt-3 text-sm text-slate-600 dark:text-slate-300"></p>
    </section>

    <!-- Tabs -->
    <div class="glass rounded-2xl p-1 shadow border border-white/40 dark:border-white/10 mb-6 flex">
      <button data-tab="login" class="tab flex-1 px-4 py-2 rounded-xl text-sm bg-slate-900 text-white">Login</button>
      <button data-tab="pay" class="tab flex-1 px-4 py-2 rounded-xl text-sm">Pembayaran</button>
    </div>

    <!-- CONTENT: LOGIN -->
    <section id="tab-login" class="grid lg:grid-cols-2 gap-8">
      <!-- Enkripsi -->
      <section class="glass rounded-3xl p-6 shadow-lg border border-white/40 dark:border-white/10">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-9 h-9 rounded-xl bg-indigo-600 text-white grid place-items-center shadow">â‘ </div>
          <h3 class="font-semibold text-lg">Masukan Enkripsi Token</h3>
        </div>

        <label class="block text-sm mb-1">User ID</label>
        <input id="loginUID" class="w-full border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/60 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 ring-indigo-500 mb-3" placeholder="Masukan Token Anda, misal: USER123">

        <div class="flex gap-2 mb-3">
          <button id="btnLoginSend" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl px-4 py-2 shadow transition btn">Kirim Token</button>
          <button id="btnLoginClear" class="px-4 py-2 rounded-xl bg-slate-200/80 dark:bg-slate-800/60 hover:bg-slate-200 dark:hover:bg-slate-800 transition btn">Bersihkan</button>
        </div>

        <div class="relative">
          <label class="block text-sm mb-1">Ciphertext (ke user)</label>
          <textarea id="loginCipher" rows="2" readonly class="w-full border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/60 rounded-xl px-3 py-2 font-mono"></textarea>
          <button id="copyLoginToken" class="absolute right-2 -top-2 translate-y-[-50%] text-xs bg-slate-900 text-white px-3 py-1 rounded-lg shadow hover:shadow-md transition">Copy</button>
        </div>
      </section>

      <!-- Verifikasi -->
      <section class="glass rounded-3xl p-6 shadow-lg border border-white/40 dark:border-white/10">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-9 h-9 rounded-xl bg-emerald-600 text-white grid place-items-center shadow">â‘¡</div>
          <h3 class="font-semibold text-lg">Login â€” Verifikasi Token</h3>
        </div>

        <label class="block text-sm mb-1">Tempel Ciphertext</label>
        <textarea id="loginCipherIn" rows="2" class="w-full border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/60 rounded-xl px-3 py-2 font-mono mb-3" placeholder="otomatis terisi setelah kirim"></textarea>

        <div class="flex gap-2 mb-3">
          <button id="btnLoginVerify" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl px-4 py-2 shadow transition btn">Verifikasi</button>
          <button id="btnLoginResetVerify" class="px-4 py-2 rounded-xl bg-slate-200/80 dark:bg-slate-800/60 hover:bg-slate-200 dark:hover:bg-slate-800 transition btn">Reset</button>
        </div>

        <div class="relative">
          <label class="block text-sm mb-1">Hasil Dekripsi</label>
          <textarea id="loginDecrypted" rows="2" readonly class="w-full border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/60 rounded-xl px-3 py-2 font-mono"></textarea>
        </div>

        <p id="loginStatus" class="mt-3 text-sm"></p>
      </section>
    </section>

    <!-- CONTENT: PEMBAYARAN -->
    <section id="tab-pay" class="grid lg:grid-cols-2 gap-8 hidden">
      <!-- Enkripsi -->
      <section class="glass rounded-3xl p-6 shadow-lg border border-white/40 dark:border-white/10">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-9 h-9 rounded-xl bg-fuchsia-600 text-white grid place-items-center shadow">â‘ </div>
          <h3 class="font-semibold text-lg">Pembayaran â€” Enkripsi Token</h3>
        </div>

        <label class="block text-sm mb-1">User ID</label>
        <input id="payUID" class="w-full border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/60 rounded-xl px-3 py-2 mb-3" placeholder="misal: USER123">

        <label class="block text-sm mb-1">Merchant</label>
        <input id="payMerchant" class="w-full border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/60 rounded-xl px-3 py-2 mb-3" placeholder="misal: ZYYU">

        <label class="block text-sm mb-1">Nominal (IDR)</label>
        <input id="payAmount" class="w-full border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/60 rounded-xl px-3 py-2 mb-3" placeholder="misal: 125000">

        <div class="flex gap-2 mb-3">
          <button id="btnPaySend" class="flex-1 bg-fuchsia-600 hover:bg-fuchsia-700 text-white rounded-xl px-4 py-2 shadow transition btn">Enkripsi & Kirim</button>
          <button id="btnPayClear" class="px-4 py-2 rounded-xl bg-slate-200/80 dark:bg-slate-800/60 hover:bg-slate-200 dark:hover:bg-slate-800 transition btn">Bersihkan</button>
        </div>

        <div class="relative">
          <label class="block text-sm mb-1">Ciphertext (ke user)</label>
          <textarea id="payCipher" rows="2" readonly class="w-full border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/60 rounded-xl px-3 py-2 font-mono"></textarea>
          <button id="copyPayToken" class="absolute right-2 -top-2 translate-y-[-50%] text-xs bg-slate-900 text-white px-3 py-1 rounded-lg shadow hover:shadow-md transition">Copy</button>
        </div>
      </section>

      <!-- Verifikasi -->
      <section class="glass rounded-3xl p-6 shadow-lg border border-white/40 dark:border-white/10">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-9 h-9 rounded-xl bg-emerald-600 text-white grid place-items-center shadow">â‘¡</div>
          <h3 class="font-semibold text-lg">Pembayaran â€” Verifikasi Token</h3>
        </div>

        <label class="block text-sm mb-1">Tempel Ciphertext</label>
        <textarea id="payCipherIn" rows="2" class="w-full border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/60 rounded-xl px-3 py-2 font-mono mb-3" placeholder="otomatis terisi setelah kirim"></textarea>

        <div class="flex gap-2 mb-3">
          <button id="btnPayVerify" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl px-4 py-2 shadow transition btn">Dekripsi & Verifikasi</button>
          <button id="btnPayResetVerify" class="px-4 py-2 rounded-xl bg-slate-200/80 dark:bg-slate-800/60 hover:bg-slate-200 dark:hover:bg-slate-800 transition btn">Reset</button>
        </div>

        <div class="relative">
          <label class="block text-sm mb-1">Hasil Dekripsi</label>
          <textarea id="payDecrypted" rows="2" readonly class="w-full border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/60 rounded-xl px-3 py-2 font-mono"></textarea>
        </div>

        <p id="payStatus" class="mt-3 text-sm"></p>

        <!-- Struk -->
        <div id="receipt" class="hidden mt-4 p-4 rounded-2xl border bg-white/70 dark:bg-slate-900/40">
          <div class="font-semibold mb-2">Struk Pembayaran</div>
          <div class="grid grid-cols-2 text-sm gap-y-1">
            <div class="text-slate-500">User</div><div id="rUser" class="font-mono"></div>
            <div class="text-slate-500">Merchant</div><div id="rMer" class="font-mono"></div>
            <div class="text-slate-500">Nominal</div><div id="rAmt" class="font-mono"></div>
            <div class="text-slate-500">Status</div><div class="text-emerald-700 font-medium">Terverifikasi</div>
          </div>
        </div>
      </section>
    </section>

    <!-- Ringkasan -->
    <section class="glass rounded-3xl p-6 shadow-lg border border-white/40 dark:border-white/10 mt-8">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-9 h-9 rounded-xl bg-violet-600 text-white grid place-items-center shadow">ðŸ§¾</div>
        <h3 class="font-semibold text-lg">Ringkasan (Sesuai Spesifikasi Tugas)</h3>
      </div>
      <div class="grid md:grid-cols-3 gap-3 text-sm">
        <div class="p-3 rounded-xl bg-white/60 dark:bg-slate-900/40 border border-white/40 dark:border-white/10">
          <div class="text-slate-500 dark:text-slate-400">Kunci (a, b)</div>
          <div id="summaryKeys" class="font-semibold mt-1">â€”</div>
        </div>
        <div class="p-3 rounded-xl bg-white/60 dark:bg-slate-900/40 border border-white/40 dark:border-white/10">
          <div class="text-slate-500 dark:text-slate-400">Ciphertext</div>
          <div id="summaryCipher" class="font-mono mt-1 break-all">â€”</div>
        </div>
        <div class="p-3 rounded-xl bg-white/60 dark:bg-slate-900/40 border border-white/40 dark:border-white/10">
          <div class="text-slate-500 dark:text-slate-400">Plaintext terdekripsi</div>
          <div id="summaryPlain" class="font-mono mt-1 break-all">â€”</div>
        </div>
      </div>
    </section>

    <div id="toast" class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 bg-slate-900 text-white text-sm px-4 py-2 rounded-xl shadow-lg"></div>
  </main>

  <script>
    // === THEME ===
    const themeToggle = document.getElementById("themeToggle");
    function applyTheme(){ const dark = localStorage.getItem("pv-dark")==="1"; document.documentElement.classList.toggle("dark", dark); themeToggle.textContent = dark ? "â˜€ï¸ Light" : "ðŸŒ™ Dark"; }
    themeToggle.addEventListener("click", ()=>{ const cur=localStorage.getItem("pv-dark")==="1"; localStorage.setItem("pv-dark", cur?"0":"1"); applyTheme();});
    applyTheme();

    // === UTILS ===
    function toast(msg){ const t=document.getElementById("toast"); t.textContent=msg; t.classList.remove("hidden"); t.style.opacity="1"; setTimeout(()=>{t.style.transition="opacity .6s"; t.style.opacity="0";},1200); setTimeout(()=>{t.classList.add("hidden"); t.style.transition="";},1900); }
    function gcd(a,b){ while(b)[a,b]=[b,a%b]; return Math.abs(a); }
    function modInverse(a,m=26){ a=((a%m)+m)%m; for(let i=1;i<m;i++) if((a*i)%m===1) return i; return null; }
    function isValidKey(a,b){ if(!Number.isInteger(a)||!Number.isInteger(b)) return [false,"a/b harus bilangan bulat."]; if(gcd(a,26)!==1) return [false,"a harus koprima dgn 26 (1,3,5,7,9,11,15,17,19,21,23,25)."]; if(b<0||b>25) return [false,"b harus 0..25."]; return [true,""]; }
    function setBadge(ok,text){ const badge=document.getElementById("keyBadge"); badge.textContent=text; badge.className="ml-auto text-xs px-2 py-1 rounded-full "+(ok?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-700 dark:bg-rose-900/40 dark:text-rose-300"); }
    function setSmall(el,ok,msg){ el.className="mt-3 text-sm "+(ok?"text-emerald-700 dark:text-emerald-300":"text-rose-700 dark:text-rose-300"); el.textContent=msg; }
    function affineEncrypt(text,a,b){ let out=""; for(const ch of text){ if(/[A-Za-z]/.test(ch)){ const up=ch===ch.toUpperCase(); const base=up?65:97; const x=ch.charCodeAt(0)-base; const y=(a*x+b)%26; out+=String.fromCharCode(y+base);} else out+=ch;} return out; }
    function affineDecrypt(text,a,b){ const aInv=modInverse(a,26); if(aInv===null) throw new Error(`Tidak ada invers modular untuk a=${a} (mod 26).`); let out=""; for(const ch of text){ if(/[A-Za-z]/.test(ch)){ const up=ch===ch.toUpperCase(); const base=up?65:97; const y=ch.charCodeAt(0)-base; const x=(aInv*(y-b))%26; const xPos=(x+26)%26; out+=String.fromCharCode(xPos+base);} else out+=ch;} return out; }

    // === KEY EVENTS ===
    const keyA=document.getElementById("keyA"), keyB=document.getElementById("keyB"), keyStatus=document.getElementById("keyStatus");
    document.getElementById("btnCheckKey").addEventListener("click",()=>{ const a=parseInt(keyA.value,10), b=parseInt(keyB.value,10); const [ok,msg]=isValidKey(a,b); if(ok){ setBadge(true,"Kunci valid"); setSmall(keyStatus,true,`Siap dipakai: a=${a}, b=${b}`);} else { setBadge(false,"Tidak valid"); setSmall(keyStatus,false,`Kunci tidak valid: ${msg}`);} });
    document.getElementById("btnRandomKey").addEventListener("click",()=>{ const validA=[1,3,5,7,9,11,15,17,19,21,23,25]; keyA.value=validA[Math.floor(Math.random()*validA.length)]; keyB.value=Math.floor(Math.random()*26); document.getElementById("btnCheckKey").click(); });

    // === TABS ===
    const tabs=document.querySelectorAll(".tab");
    const group={ login:document.getElementById("tab-login"), pay:document.getElementById("tab-pay") };
    tabs.forEach(btn=>btn.addEventListener("click",()=>{ tabs.forEach(b=>b.classList.remove("bg-slate-900","text-white")); btn.classList.add("bg-slate-900","text-white"); Object.values(group).forEach(s=>s.classList.add("hidden")); group[btn.dataset.tab].classList.remove("hidden"); }));

    // === LOGIN FLOW ===
    const loginUID=document.getElementById("loginUID"), loginCipher=document.getElementById("loginCipher"), loginCipherIn=document.getElementById("loginCipherIn"), loginDecrypted=document.getElementById("loginDecrypted"), loginStatus=document.getElementById("loginStatus");
    document.getElementById("btnLoginSend").addEventListener("click",()=>{ try{ const a=parseInt(keyA.value,10),b=parseInt(keyB.value,10); const [ok,msg]=isValidKey(a,b); if(!ok) throw new Error(msg); const uid=(loginUID.value||"USER").trim(); const pt=`LOGIN-${uid}`; const ct=affineEncrypt(pt,a,b); loginCipher.value=ct; loginCipherIn.value=ct; toast("Token login dikirim"); }catch(e){ toast(e.message||String(e)); }});
    document.getElementById("btnLoginVerify").addEventListener("click",()=>{ try{ const a=parseInt(keyA.value,10),b=parseInt(keyB.value,10); const [ok,msg]=isValidKey(a,b); if(!ok) throw new Error(msg); const ct=(loginCipherIn.value||"").trim(); const rec=affineDecrypt(ct,a,b); loginDecrypted.value=rec; const expected=`LOGIN-${(loginUID.value||"USER").trim()}`; const pass=rec===expected; loginStatus.className="mt-3 text-sm "+(pass?"text-emerald-700 dark:text-emerald-300":"text-rose-700 dark:text-rose-300"); loginStatus.textContent=pass?"âœ… Verifikasi LOGIN berhasil":"âŒ Verifikasi LOGIN gagal"; toast(pass?"Login tervalidasi":"Token salah"); summaryKeys.textContent=`(${a}, ${b})`; summaryCipher.textContent=ct; summaryPlain.textContent=rec; }catch(e){ toast(e.message||String(e)); }});
    document.getElementById("btnLoginClear").addEventListener("click",()=>{ loginUID.value=""; loginCipher.value=""; loginCipherIn.value=""; toast("Form login dibersihkan"); });
    document.getElementById("btnLoginResetVerify").addEventListener("click",()=>{ loginDecrypted.value=""; loginStatus.textContent=""; toast("Verifikasi login direset"); });
    document.getElementById("copyLoginToken").addEventListener("click",async()=>{ try{ await navigator.clipboard.writeText(loginCipher.value||""); toast("Token disalin"); }catch{ toast("Gagal menyalin"); } });

    // === PAY FLOW ===
    const payUID=document.getElementById("payUID"), payMerchant=document.getElementById("payMerchant"), payAmount=document.getElementById("payAmount"), payCipher=document.getElementById("payCipher"), payCipherIn=document.getElementById("payCipherIn"), payDecrypted=document.getElementById("payDecrypted"), payStatus=document.getElementById("payStatus"), rUser=document.getElementById("rUser"), rMer=document.getElementById("rMer"), rAmt=document.getElementById("rAmt"), receipt=document.getElementById("receipt");
    const normAmount=str=>(str||"").replace(/[.,\s]/g,"");
    document.getElementById("btnPaySend").addEventListener("click",()=>{ try{ const a=parseInt(keyA.value,10),b=parseInt(keyB.value,10); const [ok,msg]=isValidKey(a,b); if(!ok) throw new Error(msg); const uid=(payUID.value||"USER").trim(); const mer=(payMerchant.value||"MERCHANT").trim(); const amt=normAmount(payAmount.value||"0"); if(!/^\d+$/.test(amt)) throw new Error("Nominal hanya angka."); const pt=`PAY-${uid}-${mer}-${amt}`; const ct=affineEncrypt(pt,a,b); payCipher.value=ct; payCipherIn.value=ct; toast("Token pembayaran dikirim"); }catch(e){ toast(e.message||String(e)); }});
    document.getElementById("btnPayVerify").addEventListener("click",()=>{ try{ const a=parseInt(keyA.value,10),b=parseInt(keyB.value,10); const [ok,msg]=isValidKey(a,b); if(!ok) throw new Error(msg); const ct=(payCipherIn.value||"").trim(); const rec=affineDecrypt(ct,a,b); payDecrypted.value=rec; const uid=(payUID.value||"USER").trim(); const mer=(payMerchant.value||"MERCHANT").trim(); const amt=normAmount(payAmount.value||"0"); const expected=`PAY-${uid}-${mer}-${amt}`; const pass=rec===expected; payStatus.className="mt-3 text-sm "+(pass?"text-emerald-700 dark:text-emerald-300":"text-rose-700 dark:text-rose-300"); payStatus.textContent= pass?"âœ… Verifikasi PEMBAYARAN berhasil":"âŒ Verifikasi PEMBAYARAN gagal"; receipt.classList.toggle("hidden", !pass); if(pass){ rUser.textContent=uid; rMer.textContent=mer; rAmt.textContent="Rp "+(+amt).toLocaleString("id-ID"); toast("Pembayaran tervalidasi âœ”"); } else { toast("Token pembayaran tidak valid âœ–"); } summaryKeys.textContent=`(${a}, ${b})`; summaryCipher.textContent=ct; summaryPlain.textContent=rec; }catch(e){ payStatus.className="mt-3 text-sm text-rose-700 dark:text-rose-300"; payStatus.textContent=`Error: ${e.message||String(e)}`; }});
    document.getElementById("btnPayClear").addEventListener("click",()=>{ payUID.value=""; payMerchant.value=""; payAmount.value=""; payCipher.value=""; payCipherIn.value=""; receipt.classList.add("hidden"); toast("Form pembayaran dibersihkan"); });
    document.getElementById("btnPayResetVerify").addEventListener("click",()=>{ payDecrypted.value=""; payStatus.textContent=""; receipt.classList.add("hidden"); toast("Verifikasi pembayaran direset"); });
    document.getElementById("copyPayToken").addEventListener("click",async()=>{ try{ await navigator.clipboard.writeText(payCipher.value||""); toast("Token pembayaran disalin"); }catch{ toast("Gagal menyalin"); } });
  </script>
</body>
</html>
